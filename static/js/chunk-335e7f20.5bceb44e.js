(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-335e7f20"],{"2a79":function(e,t,o){e.exports=o.p+"static/img/file_pdf.1bf2177c.png"},"2b24":function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"Files_VoucherList_Container"},[s("div",{staticClass:"top_buttons"},["accounting"!=e.table_type?s("el-upload",{attrs:{action:"/pdf/upload","show-file-list":!1,"http-request":e.Upload}},[s("el-button",{attrs:{icon:"el-icon-upload2"}},[e._v("上传文件")])],1):e._e(),"accounting"!=e.table_type?s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-download"},on:{click:e.List_download}},[e._v(" 打包下载 ")]):e._e()],1),s("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{prop:"file_name",label:"文件名"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"filebox"},[s("img",{attrs:{src:o("2a79")}}),s("a",{on:{click:function(o){return e.downloadFiles(t.row)}}},[e._v(e._s(t.row.file_name))])])]}}])}),s("el-table-column",{attrs:{prop:"fixtime",label:"修改时间"}})],1)],1)},a=[],i=o("5530"),n=(o("fb6a"),o("ac1f"),o("1276"),o("b0c0"),o("d3b7"),o("3ca3"),o("ddb0"),o("2b3d"),o("2f62")),l={data:function(){return{tableData:[],loading:!0,multipleSelection:[],projectCode:this.$store.state.contract_files.projectCode,contractInfoId:this.$store.state.contract_files.contractInfoId}},created:function(){this.refresh()},methods:Object(i["a"])(Object(i["a"])({},Object(n["c"])(["get_files"])),{},{handleSelectionChange:function(e){this.multipleSelection=e},refresh:function(){this.tableData=[],console.log(this.$store.state);for(var e=0;e<this.$store.state.contract_files.voucherList.length;e++){var t={};t.file_name=this.$store.state.contract_files.voucherList[e].fileDisplayName,t.fixtime=this.$store.state.contract_files.voucherList[e].gmtCreate,t.fileId=this.$store.state.contract_files.voucherList[e].fileId,this.tableData.push(t)}},Upload:function(e){var t=this,o=this;console.log(e);var s="/file/uploadVoucher";if("pdf"!=e.file.name.split(".").slice(-1))this.$message.warning("上传文件只能是pdf格式!");else if(e.file.size/1024/1024>10)this.$message.warning("上传文件大小不得超过10M!");else{var a=new FormData;a.append("file",e.file),a.append("contractInfoId",o.contractInfoId),console.log(a),o.request(s,a,"POST",{}).then((function(e){if(console.log(e),"success"==e.data.status){t.$message({type:"success",message:"上传成功！"});var s="/file/getFileListByContractInfoId?contractInfoId="+o.contractInfoId;o.request(s,{},"GET",{}).then((function(e){console.log(e.data),"success"==e.data.status?(t.get_files(e.data.data),sessionStorage.setItem("state",JSON.stringify(t.$store.state)),o.refresh()):o.$message.error(e.data.data.errMsg)})).catch((function(e){console.log(e),o.$message.error("出错了！")}))}else t.$message({message:e.data.data.errMsg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"出错了！",type:"error"})}))}},downloadFiles:function(e){var t=this,o=this,s="/file/downloadFileById?fileId="+e.fileId;o.request(s,{},"GET",{},"blob").then((function(e){if(void 0!=e.headers["content-disposition"]){t.$notify({title:"成功",message:"准备开始下载！",type:"success"});var o=decodeURI(e.headers["content-disposition"].split("fileName=")[1]);try{var s=new Blob([e.data],{type:"application/force-download"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.setAttribute("download",o),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(n){console.log(n),t.$message({message:"数据请求失败！",type:"error"})}}else t.$message({message:"文件可能丢失了！",type:"error"})})).catch((function(e){console.log(e),t.$message({message:"出错了！",type:"error"})}))},List_download:function(){var e=this,t=this;if(console.log(this.multipleSelection),0==this.multipleSelection.length)this.$message.warning("请选择要下载的文件！");else{this.$notify({title:"成功",message:"准备开始下载！",type:"success"});var o="/file/downloadPackage?projectCode="+this.projectCode+"&fileIdList="+this.multipleSelection[0].fileId;if(this.multipleSelection.length>1)for(var s=1;s<this.multipleSelection.length;s++)o=o+"&fileIdList="+this.multipleSelection[s].fileId;t.request(o,{},"GET",{},"blob").then((function(t){if(void 0!=t.headers["content-disposition"]){e.$notify({title:"成功",message:"准备开始下载！",type:"success"});var o=decodeURI(t.headers["content-disposition"].split("fileName=")[1]);try{var s=new Blob([t.data],{type:"application/force-download"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.setAttribute("download",o),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(n){console.log(n),e.$message({message:"数据请求失败！",type:"error"})}}else e.$message({message:"文件可能丢失了！",type:"error"})})).catch((function(t){console.log(t),e.$message({message:"出错了！",type:"error"})}))}}})},c=l,r=(o("c846"),o("2877")),d=Object(r["a"])(c,s,a,!1,null,null,null);t["default"]=d.exports},"9d8e":function(e,t,o){},c846:function(e,t,o){"use strict";o("9d8e")},fb6a:function(e,t,o){"use strict";var s=o("23e7"),a=o("861d"),i=o("e8b5"),n=o("23cb"),l=o("50c4"),c=o("fc6a"),r=o("8418"),d=o("b622"),f=o("1dde"),u=o("ae40"),p=f("slice"),h=u("slice",{ACCESSORS:!0,0:0,1:2}),g=d("species"),m=[].slice,b=Math.max;s({target:"Array",proto:!0,forced:!p||!h},{slice:function(e,t){var o,s,d,f=c(this),u=l(f.length),p=n(e,u),h=n(void 0===t?u:t,u);if(i(f)&&(o=f.constructor,"function"!=typeof o||o!==Array&&!i(o.prototype)?a(o)&&(o=o[g],null===o&&(o=void 0)):o=void 0,o===Array||void 0===o))return m.call(f,p,h);for(s=new(void 0===o?Array:o)(b(h-p,0)),d=0;p<h;p++,d++)p in f&&r(s,d,f[p]);return s.length=d,s}})}}]);