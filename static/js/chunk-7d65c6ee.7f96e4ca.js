(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7d65c6ee"],{"2a79":function(e,t){e.exports="data:image/png;base64,"},a348:function(e,t,a){"use strict";a("eb74")},bc15:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"Files_Onlyfile_Container"},[s("div",{staticClass:"top_buttons"},["accounting"!=e.table_type?s("el-upload",{attrs:{action:"/pdf/upload","show-file-list":!1,"http-request":e.Upload}},[s("el-button",{attrs:{icon:"el-icon-upload2"}},[e._v("上传文件")])],1):e._e(),"accounting"!=e.table_type?s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-download"},on:{click:e.List_download}},[e._v(" 打包下载 ")]):e._e(),"accounting"==e.table_type?s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-download"},on:{click:e.getAccountingInfo}},[e._v(" 生成入账通知单 ")]):e._e()],1),s("el-table",{ref:"multipleTable",staticClass:"tableStyle",staticStyle:{width:"100%"},attrs:{data:e.tableData,"tooltip-effect":"dark"}},[s("el-table-column",{attrs:{prop:"file_name",label:"文件名"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"filebox"},["accounting"==e.table_type?s("img",{attrs:{src:a("e931")}}):s("img",{attrs:{src:a("2a79")}}),s("a",{on:{click:function(a){return e.downloadFiles(t.row)}}},[e._v(e._s(t.row.file_name))])])]}}])}),s("el-table-column",{attrs:{prop:"fixtime",label:"修改时间"}}),s("el-table-column",{attrs:{prop:"setting",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{icon:"el-icon-data-board",type:"text"},on:{click:function(a){return e.pdf_preview(t.row)}}},[e._v(" 预览 ")])]}}])})],1)],1)},o=[],i=a("5530"),c=(a("fb6a"),a("ac1f"),a("1276"),a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("2f62")),n={data:function(){return{table_type:this.$route.query.type,tableData:[],loading:!0,multipleSelection:[],projectCode:this.$store.state.contract_files.projectCode,contractInfoId:this.$store.state.contract_files.contractInfoId}},created:function(){console.log(this.$route.query),this.refresh()},methods:Object(i["a"])(Object(i["a"])({},Object(c["c"])(["get_files"])),{},{handleSelectionChange:function(e){this.multipleSelection=e},refresh:function(){switch(this.tableData=[],this.$route.query.type){case"contract":if(null!=this.$store.state.contract_files.contract){var e={};e.file_name=this.$store.state.contract_files.contract.fileDisplayName,e.fixtime=this.$store.state.contract_files.contract.gmtCreate,e.fileId=this.$store.state.contract_files.contract.fileId,this.tableData.push(e)}break;case"accounting":if(null!=this.$store.state.contract_files.accounting){var t={};t.file_name=this.$store.state.contract_files.accounting.fileDisplayName,t.fixtime=this.$store.state.contract_files.accounting.gmtCreate,t.fileId=this.$store.state.contract_files.accounting.fileId,this.tableData.push(t)}break;case"checklist":if(null!=this.$store.state.contract_files.checklist){var a={};a.file_name=this.$store.state.contract_files.checklist.fileDisplayName,a.fixtime=this.$store.state.contract_files.checklist.gmtCreate,a.fileId=this.$store.state.contract_files.checklist.fileId,this.tableData.push(a)}break;case"invoice":if(null!=this.$store.state.contract_files.invoice){var s={};s.file_name=this.$store.state.contract_files.invoice.fileDisplayName,s.fixtime=this.$store.state.contract_files.invoice.gmtCreate,s.fileId=this.$store.state.contract_files.invoice.fileId,this.tableData.push(s)}break;default:break}},Upload:function(e){var t=this,a=this;console.log(e);var s="";switch(this.$route.query.type){case"contract":s="/file/uploadContract";break;case"accounting":s="/file/uploadVoucher";break;case"checklist":s="/file/uploadChecklist";break;case"invoice":s="/file/uploadInvoice";break;default:break}if("pdf"!=e.file.name.split(".").slice(-1))this.$message.warning("上传文件只能是pdf格式!");else if(e.file.size/1024/1024>10)this.$message.warning("上传文件大小不得超过10M!");else{var o=new FormData;o.append("file",e.file),o.append("contractInfoId",a.contractInfoId),console.log(o),a.request(s,o,"POST",{}).then((function(e){if(console.log(e),"success"==e.data.status){t.$message({type:"success",message:"上传成功！"});var s="/file/getFileListByContractInfoId?contractInfoId="+a.contractInfoId;a.request(s,{},"GET",{}).then((function(e){console.log(e.data),"success"==e.data.status?(t.get_files(e.data.data),sessionStorage.setItem("state",JSON.stringify(t.$store.state)),a.refresh()):a.$message.error(e.data.data.errMsg)})).catch((function(e){console.log(e),a.$message.error("出错了！")}))}else t.$message({message:e.data.data.errMsg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"出错了！",type:"error"})}))}},downloadFiles:function(e){var t=this,a=this,s="/file/downloadFileById?fileId="+e.fileId;a.request(s,{},"GET",{},"blob").then((function(e){if(void 0!=e.headers["content-disposition"]){t.$notify({title:"成功",message:"准备开始下载！",type:"success"});var a=decodeURI(e.headers["content-disposition"].split("fileName=")[1]);try{var s=new Blob([e.data],{type:"application/force-download"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.setAttribute("download",a),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(c){console.log(c),t.$message({message:"数据请求失败！",type:"error"})}}else t.$message({message:"文件可能丢失了！",type:"error"})})).catch((function(e){console.log(e),t.$message({message:"出错了！",type:"error"})}))},List_download:function(){var e=this,t=this;if(console.log(this.multipleSelection),0==this.multipleSelection.length)this.$message.warning("请选择要下载的文件！");else{var a="/file/downloadPackage?projectCode="+this.projectCode+"&fileIdList="+this.multipleSelection[0].fileId;if(this.multipleSelection.length>1)for(var s=1;s<this.multipleSelection.length;s++)a=a+"&fileIdList="+this.multipleSelection[s].fileId;t.request(a,{},"GET",{},"blob").then((function(t){if(void 0!=t.headers["content-disposition"]){e.$notify({title:"成功",message:"准备开始下载！",type:"success"});var a=decodeURI(t.headers["content-disposition"].split("fileName=")[1]);try{var s=new Blob([t.data],{type:"application/force-download"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.setAttribute("download",a),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(c){console.log(c),e.$message({message:"数据请求失败！",type:"error"})}}else e.$message({message:"文件可能丢失了！",type:"error"})})).catch((function(t){console.log(t),e.$message({message:"出错了！",type:"error"})}))}},getAccountingInfo:function(){var e=this,t=this,a="/file/generateAccounting?contractInfoId="+this.contractInfoId;t.request(a,{},"GET",{}).then((function(a){if("success"==a.data.status){t.$message.success("入账通知单已生成！");var s="/file/getFileListByContractInfoId?contractInfoId="+t.contractInfoId;t.request(s,{},"GET",{}).then((function(a){console.log(a.data),"success"==a.data.status?(e.get_files(a.data.data),sessionStorage.setItem("state",JSON.stringify(e.$store.state)),t.refresh()):t.$message.error(a.data.data.errMsg)})).catch((function(e){console.log(e),t.$message.error("出错了！")}))}else t.$message({message:a.data.data.errMsg,type:"error"})})).catch((function(e){console.log(e),t.$message({message:"出错了！",type:"error"})}))},pdf_preview:function(e){console.log(e),this.$router.push({path:"./pdf_reader",query:{pdfid:e.fileId}})}})},l=n,r=(a("a348"),a("2877")),f=Object(r["a"])(l,s,o,!1,null,null,null);t["default"]=f.exports},e931:function(e,t){e.exports="data:image/png;base64,"},eb74:function(e,t,a){}}]);