(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d2d9aae"],{"08f3":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"Files_Controller_Container"},[o("div",{staticClass:"top_buttons"},[t.multipleSelection.length>0?o("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-download"},on:{click:t.List_download}},[t._v(" 打包下载 ")]):t._e()],1),o("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),o("el-table-column",{attrs:{prop:"file_type",label:"文件名"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"filebox"},[["入账通知单"].includes(e.row.file_type)?o("img",{attrs:{src:s("e931")}}):["合同","认定清单","发票"].includes(e.row.file_type)?o("img",{attrs:{src:s("2a79")}}):o("img",{attrs:{src:s("3881")}}),["合同","入账通知单","认定清单","发票"].includes(e.row.file_type)?o("el-button",{attrs:{type:"text",disabled:""==e.row.fixtime},on:{click:function(s){return t.downloadFiles(e.row)}}},[t._v(" "+t._s(e.row.file_type)+" ")]):t._e(),["专利","到款凭证"].includes(e.row.file_type)?o("el-button",{attrs:{type:"text",disabled:""==e.row.fixtime},on:{click:function(s){return t.seeFiles(e.row)}}},[t._v(" "+t._s(e.row.file_type)+" ")]):t._e()],1)]}}])}),o("el-table-column",{attrs:{prop:"fixtime",label:"修改时间"}}),o("el-table-column",{attrs:{prop:"setting",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("div",{staticClass:"setting"},[""!=e.row.fixtime&&["合同","认定清单","发票"].includes(e.row.file_type)?o("el-button",{attrs:{icon:"el-icon-data-board",type:"text"},on:{click:function(s){return t.pdf_preview(e.row)}}},[t._v(" 预览 ")]):t._e(),""==e.row.fixtime&&["入账通知单"].includes(e.row.file_type)?o("el-button",{attrs:{icon:"el-icon-document",type:"text"},on:{click:t.getAccountingInfo}},[t._v(" 生成 ")]):t._e(),["合同","认定清单","发票"].includes(e.row.file_type)&&""==e.row.fixtime?o("el-upload",{attrs:{action:"/pdf/upload","show-file-list":!1,"http-request":t.Upload}},[o("el-button",{attrs:{type:"text",icon:"el-icon-upload2"},on:{click:function(s){return t.get_fileType(e.row.file_type)}}},[t._v("上传")])],1):t._e(),["合同","认定清单","发票"].includes(e.row.file_type)&&""!=e.row.fixtime?o("el-upload",{attrs:{action:"/pdf/upload","show-file-list":!1,"http-request":t.Upload}},[o("el-button",{attrs:{type:"text",icon:"el-icon-upload2"},on:{click:function(s){return t.get_fileType(e.row.file_type)}}},[t._v("重新上传")])],1):t._e()],1)]}}])})],1)],1)},i=[],a=s("5530"),n=(s("fb6a"),s("ac1f"),s("1276"),s("b0c0"),s("d3b7"),s("3ca3"),s("ddb0"),s("2b3d"),s("2f62")),c={data:function(){return{tableData:[{file_type:"合同",fixtime:null==this.$store.state.contract_files.contract?"":this.$store.state.contract_files.contract.gmtCreate,fileId:null==this.$store.state.contract_files.contract?"":this.$store.state.contract_files.contract.fileId},{file_type:"入账通知单",fixtime:null==this.$store.state.contract_files.accounting?"":this.$store.state.contract_files.accounting.gmtCreate,fileId:null==this.$store.state.contract_files.accounting?"":this.$store.state.contract_files.accounting.fileId},{file_type:"到款凭证",fixtime:0==this.$store.state.contract_files.voucherList.length?"":this.$store.state.contract_files.voucherList[this.$store.state.contract_files.voucherList.length-1].gmtCreate},{file_type:"认定清单",fixtime:null==this.$store.state.contract_files.checklist?"":this.$store.state.contract_files.checklist.gmtCreate,fileId:null==this.$store.state.contract_files.checklist?"":this.$store.state.contract_files.checklist.fileId},{file_type:"发票",fixtime:null==this.$store.state.contract_files.invoice?"":this.$store.state.contract_files.invoice.gmtCreate,fileId:null==this.$store.state.contract_files.invoice?"":this.$store.state.contract_files.invoice.fileId},{file_type:"专利"}],loading:!0,multipleSelection:[],upload_fileType:"",projectCode:this.$store.state.contract_files.projectCode,contractInfoId:this.$store.state.contract_files.contractInfoId}},created:function(){console.log(null==this.$store.state.contract_files.contract)},methods:Object(a["a"])(Object(a["a"])({},Object(n["c"])(["get_files"])),{},{handleSelectionChange:function(t){this.multipleSelection=t},seeFiles:function(t){switch(console.log(t),t.file_type){case"到款凭证":this.$router.push({path:"./files_voucherList"});break;case"专利":this.$router.push({path:"./files_patents"});break}},get_fileType:function(t){this.upload_fileType=t},Upload:function(t){var e=this,s=this;console.log(t);var o="";switch(this.upload_fileType){case"合同":o="/file/uploadContract";break;case"入账通知单":o="/file/uploadVoucher";break;case"认定清单":o="/file/uploadChecklist";break;case"发票":o="/file/uploadInvoice";break;default:break}if("pdf"!=t.file.name.split(".").slice(-1))this.$message.warning("上传文件只能是pdf格式!");else if(t.file.size/1024/1024>10)this.$message.warning("上传文件大小不得超过10M!");else{var i=new FormData;i.append("file",t.file),i.append("contractInfoId",s.contractInfoId),console.log(i),s.request(o,i,"POST",{}).then((function(t){if(console.log(t),"success"==t.data.status){e.$message({type:"success",message:"上传成功！"});var o="/file/getFileListByContractInfoId?contractInfoId="+s.contractInfoId;s.request(o,{},"GET",{}).then((function(t){console.log(t.data),"success"==t.data.status?(e.get_files(t.data.data),sessionStorage.setItem("state",JSON.stringify(e.$store.state)),window.location.reload()):(s.$message.error(t.data.data.errMsg),window.location.reload())})).catch((function(t){console.log(t),s.$message.error("出错了！")}))}else e.$message({message:t.data.data.errMsg,type:"error"})})).catch((function(t){console.log(t),e.$message({message:"出错了！",type:"error"})}))}},downloadFiles:function(t){var e=this,s=this,o="/file/downloadFileById?fileId="+t.fileId;s.request(o,{},"GET",{},"blob").then((function(t){if(void 0!=t.headers["content-disposition"]){e.$notify({title:"成功",message:"准备开始下载！",type:"success",duration:2e3});var s=decodeURI(t.headers["content-disposition"].split("fileName=")[1]);try{var o=new Blob([t.data],{type:"application/force-download"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.setAttribute("download",s),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(n){console.log(n),e.$message({message:"数据请求失败！",type:"error"})}}else e.$message({message:"文件可能丢失了！",type:"error"})})).catch((function(t){console.log(t),e.$message({message:"出错了！",type:"error"})}))},List_download:function(){this.$notify.warning({title:"提示",message:"暂未开放！"})},getAccountingInfo:function(){var t=this,e=this,s="/file/generateAccounting?contractInfoId="+this.contractInfoId;e.request(s,{},"GET",{}).then((function(s){if("success"==s.data.status){e.$message.success("入账通知单已生成！");var o="/file/getFileListByContractInfoId?contractInfoId="+e.contractInfoId;e.request(o,{},"GET",{}).then((function(s){console.log(s.data),"success"==s.data.status?(t.get_files(s.data.data),sessionStorage.setItem("state",JSON.stringify(t.$store.state)),e.refresh()):e.$message.error(s.data.data.errMsg)})).catch((function(t){console.log(t),e.$message.error("出错了！")}))}else e.$message({message:s.data.data.errMsg,type:"error"})})).catch((function(t){console.log(t),e.$message({message:"出错了！",type:"error"})}))},pdf_preview:function(t){switch(console.log(t),t.file_type){case"合同":this.$router.push({path:"./pdf_reader",query:{pdfid:t.fileId}});break;case"认定清单":this.$router.push({path:"./pdf_reader",query:{pdfid:t.fileId}});break;case"发票":this.$router.push({path:"./pdf_reader",query:{pdfid:t.fileId}});break;case"入账通知单":this.$notify.warning({title:"提示",message:"暂不支持预览word文档！"});break}}})},l=c,r=(s("ce95"),s("2877")),f=Object(r["a"])(l,o,i,!1,null,null,null);e["default"]=f.exports},"2a79":function(t,e,s){t.exports=s.p+"static/img/file_pdf.1bf2177c.png"},3881:function(t,e,s){t.exports=s.p+"static/img/filebox.7347b85c.png"},9092:function(t,e,s){},ce95:function(t,e,s){"use strict";s("9092")},e931:function(t,e,s){t.exports=s.p+"static/img/file_word.cdded0c4.png"},fb6a:function(t,e,s){"use strict";var o=s("23e7"),i=s("861d"),a=s("e8b5"),n=s("23cb"),c=s("50c4"),l=s("fc6a"),r=s("8418"),f=s("b622"),d=s("1dde"),u=s("ae40"),p=d("slice"),h=u("slice",{ACCESSORS:!0,0:0,1:2}),g=f("species"),_=[].slice,m=Math.max;o({target:"Array",proto:!0,forced:!p||!h},{slice:function(t,e){var s,o,f,d=l(this),u=c(d.length),p=n(t,u),h=n(void 0===e?u:e,u);if(a(d)&&(s=d.constructor,"function"!=typeof s||s!==Array&&!a(s.prototype)?i(s)&&(s=s[g],null===s&&(s=void 0)):s=void 0,s===Array||void 0===s))return _.call(d,p,h);for(o=new(void 0===s?Array:s)(m(h-p,0)),f=0;p<h;p++,f++)p in d&&r(o,f,d[p]);return o.length=f,o}})}}]);